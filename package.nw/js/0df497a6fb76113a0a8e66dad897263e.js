;!function(require, directRequire){;'use strict';const React=require('react'),{connect}=require('react-redux'),ExternalPopup=require('./579ff317e2bba616b0afc89a505c4f3e.js'),WindowRegistry=require('./db2217eb4cff896bdcbc50abe005058f.js'),debugActions=require('./6ff091369f442a4678a2ed4a1f758495.js'),urlConfig=require('./f171257bbcaef547a3cf27266ccb0db2.js'),request=require('./15ba1827c7f6564a45df6bd44da3a977.js'),appserviceMessager=require('./a1dd553cc059d528bb0ef56afed53968.js'),consoleDisplay=require('./2dfc6a3df6d6fc51266b293c8420e88b.js'),C=require('./56c390e04c10e91a4aa2a2c19d9a885d.js'),tools=require('./d3976cc01aeebc5b09e11c4135b6bd8d.js'),{validType,tokenManager}=require('./dc244a5ba483ad6e0acd267d3b91b282.js'),locales=require('./common/locales/index.js'),idepluginMessager=require('./e9e3fd38aeedddd6db73d1d015ff6952.js'),mapStateToProps=(a)=>({appid:a.project.current.appid}),mapDispatchToProps=(a)=>({closeCustomAnalysis:tools.bindActionCreators(debugActions.closeCustomAnalysis,a),updateCustomAnalysisConfig:tools.bindActionCreators(debugActions.updateCustomAnalysisConfig,a)}),pluginId='analysis';class CustomAnalysis extends React.Component{constructor(a){super(a),this.onMessage=(a)=>{const{command:b,data:c,callbackID:d}=a;if('GET_APP_CONFIG'===b){const a=JSON.stringify(c.config||[]);this.props.updateCustomAnalysisConfig(a),appserviceMessager.triggerOnEvent({eventName:'onAppConfig',data:{data:c.config,type:1}}),consoleDisplay.display({command:C.DISPLAY_INFO,type:C.DISPLAY_TYPES.CUSTOM_ANALYSIS_ON_APP_CONFIG,data:{config:a}})}},this.onWindowOpen=(a)=>{this.win=a,a.on('new-win-policy',function(a,b,c){c.ignore(),b=encodeURI(b),nw.Shell.openExternal(b)})},this.onWindowClose=()=>{this.props.closeCustomAnalysis()},this.onDocumentReady=()=>{this.win&&(this.win.window.document.title=locales.config.MENU_CUSTOM_ANALYSIS)},this.state={open_ticket:''},this.pluginMessager=idepluginMessager.get(pluginId),this.pluginMessager.register(this.onMessage)}componentDidMount(){this.getTicket(),this.initGetWindow()}componentWillUnmount(){this.pluginMessager.unRegister(this.onMessage)}async getTicket(){try{const{body:a}=await request({url:`${urlConfig.getDataOpenTicket}?appid=${this.props.appid}`,needToken:1});console.log('res',a),this.setState({open_ticket:a.open_ticket})}catch(a){console.info(`custom-analysis init error: ${a}`),this.props.closeCustomAnalysis()}}async initGetWindow(){this.win=await WindowRegistry.onWindowRegistered(C.WINDOW_REGISTRY.CUSTOM_ANALYSIS);const a=this.win.window.navigator.userAgent,b=tokenManager.getSessionToken(validType.UA_TOKEN);Object.defineProperty(this.win.window.navigator,'userAgent',{get:()=>`${a} devtools wechatdevtools wechatideplugin port/${global.messageCenterPort} token/${b} extension pluginid/${pluginId}`})}render(){if(!this.state.open_ticket)return null;let a,b;try{a=1200,b=nw.Screen.screens[0].work_area.height;for(const c of nw.Screen.screens){const{work_area:{width:d,height:e}}=c;a>d&&(a=d),b>e&&(b=e)}}catch(c){a=1200,b=this.props.win?this.props.win.height:global.Win.height}const c=`https://mp.weixin.qq.com/wxopen/userdefineanalysis_ide?action=event_list&dev_code=${this.state.open_ticket}&appid=${this.props.appid}&devtools=1`;return React.createElement(ExternalPopup,{webview:!0,width:a,height:b,url:c,registryId:C.WINDOW_REGISTRY.CUSTOM_ANALYSIS,onDocumentReady:this.onDocumentReady,onWindowOpen:this.onWindowOpen,onWindowClose:this.onWindowClose})}}module.exports=connect(mapStateToProps,mapDispatchToProps)(CustomAnalysis);
;}(require("lazyload"), require);
