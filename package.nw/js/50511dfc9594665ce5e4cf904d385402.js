;!function(require, directRequire){;"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const ws=require("ws"),eventemitter3_1=require("eventemitter3"),fs=require("fs"),utils_1=require('./46d7303eb986fa402d60bf5e929aa077.js'),path=require("path"),shouldLog=()=>global.shouldLog;class CDP extends eventemitter3_1.EventEmitter{constructor(a){super(),this.host=a.port,this.logFilePath=path.join(utils_1.isMac?process.env.HOME:process.env.USERPROFILE,"Desktop","cdp-"+Date.now()+".txt"),shouldLog()&&fs.writeFileSync(this.logFilePath,"","utf-8")}init(){return new Promise((a)=>{this.wss&&this.wss.close((a)=>console.error(a)),this.wss=new ws.Server({port:this.host}),this.wss.on("connection",this.onWssConnection.bind(this)),this.wss.on("error",console.error),this.wss.on("listening",a)})}onWssConnection(a){console.log("chrome connected"),this.chromeInstance=a,a.onmessage=this.onChromeInstanceMessage.bind(this),this.onChromeInstanceMessage("{\"id\":-1, \"method\":\"Log.enable\"}"),a.onerror=console.error}onChromeInstanceMessage(a){let b="undefined"==typeof a.data?a:a.data;if("string"!=typeof b)try{b=JSON.stringify(b)}catch(a){}if(b&&0<=b.indexOf("Debugger.getPossibleBreakpoints")){const a=JSON.parse(b);if("Debugger.getPossibleBreakpoints"===a.method)return console.log("Debugger.getPossibleBreakpoints hacked"),void this.sendMessageToChromeInstance(`{"error":{"code":-32601,"message":"'Debugger.getPossibleBreakpoints' was not found","data":[{"code":-32601,"message":"'Debugger.getPossibleBreakpoints' was not found"}]},"id":${a.id}}`)}shouldLog()&&fs.writeFileSync(this.logFilePath,fs.readFileSync(this.logFilePath,"utf-8")+"\n\n<CHROME SEND>\t"+b,"utf-8"),this.emit("chromemessage",b)}sendMessageToChromeInstance(a){return this.chromeInstance?void(shouldLog()&&fs.writeFileSync(this.logFilePath,fs.readFileSync(this.logFilePath,"utf-8")+"\n\n<CLIENT RESPONSED>\t"+a,"utf-8"),this.chromeInstance.send(a)):void console.warn("chrome instance not valid")}destroy(){this.chromeInstance&&(this.chromeInstance.close(),this.chromeInstance=null),this.wss&&(this.wss.removeAllListeners(),this.wss.close(),this.wss=null)}}exports.default=CDP;
;}(require("lazyload"), require);
