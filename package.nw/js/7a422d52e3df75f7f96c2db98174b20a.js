;!function(require, directRequire){;"use strict";const React=require("react"),_=require("lodash"),idepluginManager=require('./f5a748840b272d2bf0223c95f6c8dbe3.js'),updater_1=require('./8a1cb9f18551c9fced04d3b87ddfa687.js'),ProgressRecorder=require('./664c85134de31b9a04ff1f03a1492daf.js'),Animation=require('./875171e7b864aa58d026d4fa0999fbd1.js'),locales=require('./common/locales/index.js'),report=require('./da7c31daaf542cf1796023d8e344b98a.js');var PluginStatus;(function(a){a[a.NotInstalled=0]="NotInstalled",a[a.Installing=1]="Installing",a[a.Installed=2]="Installed",a[a.Deleting=3]="Deleting"})(PluginStatus||(PluginStatus={}));class PluginPanel extends React.Component{constructor(a){super(a);const b=this.props.installedManifests,c=this.props.onlineManifests,d=Object.keys(b);for(const b of c)b.status=d.includes(b.plugin_id)?PluginStatus.Installed:PluginStatus.NotInstalled;this.state={show:!0,needReload:!1,manifests:c,tipTexts:{}},this.handleCloseClick=this.handleCloseClick.bind(this),this.changeSinglePluginStatus=this.changeSinglePluginStatus.bind(this),this.cleanPluginTipText=this.cleanPluginTipText.bind(this)}componentWillReceiveProps(a){_.isEqual(this.props.installedManifests,a.installedManifests)&&_.isEqual(this.props.onlineManifests,a.onlineManifests)||this.updatePlugins(a)}componentDidMount(){report("open_panel_plugin",!0),this._cancalLocaleListener=locales.onChangeLocale(()=>this.forceUpdate())}componentWillUnmount(){this._cancalLocaleListener&&this._cancalLocaleListener()}handleCloseClick(){this.setState(()=>({show:!1}))}handleDocClick(a){return(b)=>{b.preventDefault(),nw.Shell.openExternal(a||"https://developers.weixin.qq.com/miniprogram/dev/")}}onAnimationOut(){this.props.togglePanelVisibility(),this.state.needReload&&this.props.setConfirmInfo({show:!0,showCancel:!0,content:locales.config.RELOAD_MODAL_TEXT,callback:(a)=>{a&&chrome&&chrome.runtime.reload()}})}onAnimationIn(){}changeSinglePluginStatus(a,b){this.setState((c)=>({manifests:c.manifests.map((c)=>{return c.plugin_id===a.plugin_id&&(c.status=b),c})}))}updatePlugins(a){const b=a.installedManifests,c=a.onlineManifests,d=Object.keys(b);for(const b of c)b.status=d.includes(b.plugin_id)?PluginStatus.Installed:PluginStatus.NotInstalled;this.setState(()=>({manifests:c}))}onDownloadClick(a){return async(b)=>{b.preventDefault(),this.cleanPluginTipText(a.plugin_id),this.changeSinglePluginStatus(a,PluginStatus.Installing);const c=`download-plugin-${a.plugin_id}-${+new Date}`,d="zh"===locales.getLocale()?a.plugin_name_zh:a.plugin_name_en;ProgressRecorder.get().add({id:c,name:locales.config.PLUGIN_PROGRESS_RECORDER_NAME,successName:locales.config.PLUGIN_ADD_PROGRESS_SUCCESS_NAME,failName:locales.config.PLUGIN_ADD_PROGRESS_FAILED_NAME,type:"download",progressIndeterminate:!0,details:`${locales.config.PLUGIN_ADD} ${d}`});try{await updater_1.downloadPlugin(a),await updater_1.installPlugin(a),ProgressRecorder.get().markSuccess(c),this.setState(()=>({needReload:!0}))}catch(b){this.changeSinglePluginStatus(a,PluginStatus.NotInstalled),this.setState((b)=>({tipTexts:Object.assign({},b.tipTexts,{[a.plugin_id]:locales.config.PLUGIN_DOWNLOAD_FAILED})})),ProgressRecorder.get().markFail(c)}}}onDeleteClick(a){return(b)=>{b.preventDefault(),this.cleanPluginTipText(a.plugin_id),this.changeSinglePluginStatus(a,PluginStatus.Deleting),idepluginManager.deletePlugin(a.plugin_id,(b)=>{if(!b){const a=idepluginManager.getInstalledPluginManifest();this.props.setPluginManifests(a),this.setState(()=>({needReload:!0}))}else this.changeSinglePluginStatus(a,PluginStatus.Installed),this.setState((b)=>({tipTexts:Object.assign({},b.tipTexts,{[a.plugin_id]:locales.config.PLUGIN_REMOVE_FAILED})}))})}}cleanPluginTipText(a){this.state.tipTexts[a]&&this.setState((b)=>({tipTexts:Object.assign({},b.tipTexts,{[a]:""})}))}getPluginNodes(){return this.state.manifests.filter((a)=>a.can_delete).map((a)=>{let b;switch(a.status){case 0:b=locales.config.PLUGIN_ADD;break;case 1:b=locales.config.PLUGIN_ADDING;break;case 2:b=locales.config.PLUGIN_REMOVE;break;case 3:b=locales.config.PLUGIN_REMOVING;}const c="zh"===locales.getLocale(),d=c?a.plugin_name_zh:a.plugin_name_en,e=a.status===PluginStatus.Installing||a.status===PluginStatus.Deleting;let f=c?a.desc:a.desc_en;return f||(f=c?"\u6682\u65E0\u63CF\u8FF0":"No description"),React.createElement("div",{className:"ide-plugin-item",key:a.plugin_id},React.createElement("div",{className:"ide-plugin-item-bd"},React.createElement("div",{className:"ide-plugin-metas"},React.createElement("h3",{className:"ide-plugin-name"},d),React.createElement("span",{className:"ide-plugin-version"},a.version),React.createElement("span",{className:"ide-plugin-tag"},locales.config.PLUGIN)),React.createElement("div",{className:"ide-plugin-desc"},f,React.createElement("a",{onClick:this.handleDocClick(a.doc_url)},locales.config.LEARN_MORE))),React.createElement("div",{className:"ide-plugin-item-ft"},React.createElement("button",{className:`ui-button ${a.status===PluginStatus.Installed?"ui-button-default":"ui-button-primary"}`,disabled:e,onClick:a.status===PluginStatus.NotInstalled?this.onDownloadClick(a):this.onDeleteClick(a)},b),this.state.tipTexts[a.plugin_id]?React.createElement("p",{style:{color:"#D94E4E",fontSize:"11px"}},this.state.tipTexts[a.plugin_id]):null))})}render(){const a=this.state.show,b="500px";let c={width:b,willChange:"transform",marginLeft:`calc(-${b} / 2)`,boxShadow:"inset 0 0 0 0.5px rgba(0, 0, 0, 0.3), 0 5px 50px 0 rgba(0, 0, 0, 0.3)",borderBottomLeftRadius:"3px",borderBottomRightRadius:"3px",border:"1px solid #d6d6d6",background:"#FFF",animation:`${a?"pull-down":"pull-up"} cubic-bezier(0.165, 0.84, 0.44, 1) ${a?"0.4s":"0.2s"}`};return"dark"===this.props.theme&&(c=Object.assign({},c,{boxShadow:"rgba(0, 0, 0, 0.8) 0px 5px 50px 5px",border:"1px solid rgb(89, 89, 89)",background:"rgb(74, 74, 74)"})),React.createElement("div",null,React.createElement("div",{className:"ui-mask ui-mask-transparent",onClick:this.handleCloseClick}),React.createElement(Animation,{onAnimationIn:this.onAnimationIn.bind(this),onAnimationOut:this.onAnimationOut.bind(this),show:a,style:c,inClassName:"ui-animate-pull-down ui-dialog",outClassName:"ui-animate-pull-up ui-dialog"},React.createElement("div",{className:"ui-dialog ide-plugins-dialog",style:{position:"static",width:"500px",transform:"translate3d(0,0,0)",border:"none"}},React.createElement("div",{className:"ui-dialog-hd"},React.createElement("h3",{className:"ui-dialog-title"},locales.config.PLUGIN)),React.createElement("div",{className:"ui-dialog-bd"},React.createElement("div",{className:"ide-plugins"},this.getPluginNodes())),React.createElement("div",{className:"ui-dialog-ft"},React.createElement("div",{className:"ui-dialog-action"},React.createElement("button",{className:"ui-button ui-button-default",onClick:this.handleCloseClick},locales.config.CLOSE))))))}}module.exports=PluginPanel;
;}(require("lazyload"), require);
