;!function(require, directRequire){;"use strict";const interruptibletask_1=require('./f87c21baecac660695b0d3124dbebed6.js'),path=require("path"),mkdir=require("mkdir-p"),rmdir=require("rmdir"),CheckReservedDirectories=require('./fba5323ca1afcd71487791d6c5856665.js'),checkAppConfig=require('./1dea83a77e99a7c94f6b6f01f5c175b0.js'),checkExtJSON=require('./551bb965e1f344281d555a429cd2140c.js'),checkAppserviceJS=require('./aca8387a2744eff1c61b81cdb985e514.js'),checkPluginJSON=require('./a89be4febc57a81e9865a060f74e14c8.js'),compileJS=require('./3d1dfba33285839f5aa317a53698f4c5.js'),compileWXSS=require('./1f28f42c846af07c2adfb1a5eb2d92b6.js'),compileOther=require('./59a4de6f8f83ea2bc7d7a501d45d5c9d.js'),projectManager=require('./3bfffbe88b3d923921f851c0697974fe.js'),locales=require('./common/locales/index.js'),compileTypeConfig=require('./9fdd4ac31a05c27355910f0d74accd4c.js'),appConfigHelper=require('./76bea77e5e6bc6d9609db6f49025b7c8.js'),report=require('./da7c31daaf542cf1796023d8e344b98a.js'),{Weappdest}=require('./92320c1386e6db6a6f2556736a9bc280.js'),{checkReservedDirectories}=CheckReservedDirectories,noop=()=>{};class BuildTask extends interruptibletask_1.InterruptibleTask{constructor(...a){super(...a)}async run(a,b){if(projectManager.isGameApp(a)){const c=require('./d120b9f76f645b79bc31fb8dd10f8067.js');return c(a,b)}const c=b.onProgressUpdate||noop,d=a.compileType,e=Date.now();c("checkfilestart",locales.config.CHECKING_FILE);const f=await checkAppConfig(a,b);if(checkReservedDirectories(a),await checkExtJSON(a),await checkAppserviceJS(a,b),d===compileTypeConfig.plugin&&(await checkPluginJSON(a,b)),c("checkfileend",locales.config.FILE_CHECK_COMPLETED),this._aborted)throw interruptibletask_1.AbortEvent;const g=path.join(Weappdest,`${Date.now()}`);if(mkdir.sync(g),c("compilejsfilestart",locales.config.COMPILING_JS_FILE),await compileJS(a,{distPath:g,onProgressUpdate:c,onFilesIgnored:b.onFilesIgnored||noop}),c("compilejsfilestart",locales.config.JS_COMPILATION_COMPLETED),this._aborted)throw rmdir(g,()=>{}),interruptibletask_1.AbortEvent;if(c("compilewxssfilestart",locales.config.COMPLING_SOME_FILES.format("WXSS")),await compileWXSS(a,{distPath:g}),c("compilewxssfilestart",locales.config.COMPLING_SOME_FILES.format("WXSS")),this._aborted)throw rmdir(g,()=>{}),interruptibletask_1.AbortEvent;c("compileotherfilestart",locales.config.COMPLING_OTHER_FILES);const h=appConfigHelper.getAllPages(f);return await compileOther(a,{distPath:g,allPages:h}),c("compileotherfileend",locales.config.OTHER_FILES_COMPILATION_COMPLETED),report("client_pack_source_time",a.appid,`${Date.now()-e}`),g}}const build=(a,b)=>{return new BuildTask(a,b)};module.exports=build;
;}(require("lazyload"), require);
