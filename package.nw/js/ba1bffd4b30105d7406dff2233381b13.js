;!function(require, directRequire){;"use strict";const path=require("path"),fs=require("fs-plus"),glob=require("glob"),GenerateCodeUtils=require('./fd36934129dc7c69d71d8f26e65fccf4.js'),{compileJS,inlineSourceMap,wrapSourceCodeInDefine}=GenerateCodeUtils;var Seperator;(function(a){a.Semicolon="; ",a.NewLine="\n"})(Seperator||(Seperator={}));const protocol="weapp:///";function getSourceCodeRoot(a){return path.join(a.projectpath,a.miniprogramRoot)}async function compileJSCode(a,b){const{code:c,map:d}=await compileJS({filename:a,sourceCode:b});return wrapSourceCodeInDefine(a,inlineSourceMap(c,d))}function processNormalJSCode(a,b){const c=Seperator.Semicolon+["var __wxAppData = __wxAppData || {}","var __wxRoute","var __wxRouteBegin","var __wxAppCode__ = __wxAppCode__ || {}","var global = global || {}","var __wxAppCurrentFile__","var Component = Component || function() {}","var Behavior = Behavior || function() {}"].join(Seperator.Semicolon)+Seperator.Semicolon;return[c+b,`//# sourceURL=${protocol}${a}`].join(Seperator.NewLine)+Seperator.NewLine}async function prepareFunctionalPages(a,b){const c=getSourceCodeRoot(a),d=path.join("__wx__","functional-page.js"),e="__wx__/functional-page",f=`${e}.js`,{code:g,map:h}=await compileJS({filename:d,sourceCode:"Page({})"}),i=wrapSourceCodeInDefine(d,inlineSourceMap(g,h)),j=[`;var __wxAppCode__ = __wxAppCode__ || {}; __wxAppCode__["${e}.json"] = ${"{ \"usingComponents\": {} }"}; var __wxRoute = "${e.replace(/"/g,"\\\"")}"; var __wxRouteBegin = true; var __wxAppCurrentFile__ = "${f.replace(/"/g,"\\\"")}"; `+i,`;require("${f.replace(/"/g,"\\\"")}");`].join("\n");fs.writeFileSync(path.join(b,d),j);const k=path.join(c,"functional-pages");if(fs.existsSync(k)){const a=glob.sync("functional-pages/**/*.js",{cwd:c,nocase:!0,dot:!0,nodir:!0});await Promise.all(a.map(async(a)=>{const d=fs.readFileSync(path.join(c,a),"utf8"),e=path.join("__wx__",a),f=await compileJSCode(e,d),g=processNormalJSCode(e,f);fs.writeFileSync(path.join(b,e),g)}))}return{files:glob.sync("__wx__/**/*.js",{cwd:b,nocase:!0,dot:!0,nodir:!0}),pages:[e]}}module.exports={prepareFunctionalPages};
;}(require("lazyload"), require);
