'use strict';var _extends=Object.assign||function(a){for(var b,c=1;c<arguments.length;c++)for(var d in b=arguments[c],b)Object.prototype.hasOwnProperty.call(b,d)&&(a[d]=b[d]);return a};!function(require,directRequire){const a=require('fs'),b=require('path'),c=require('mkdir-p'),d=require('glob'),e=require('lodash'),f=require('./0634ee2ebd3e560d9d4804ecc960160f.js'),g=require('./f171257bbcaef547a3cf27266ccb0db2.js'),h=require('./efd8b4323f89b2a759d044d894e3a4f0.js'),i=require('./15ba1827c7f6564a45df6bd44da3a977.js'),j=require('./72653d4b93cdd7443296229431a7aa9a.js'),k=require('./3bfffbe88b3d923921f851c0697974fe.js'),l=require('./d28a711224425b00101635efe1034c99.js'),m=require('./56c390e04c10e91a4aa2a2c19d9a885d.js'),n=require('./a8c87029da0fa06e986298d447ab0fe2.js'),o=require('./84858de8a097c9cf84ff2c2e3d86e2a9.js'),p=require('./df6d0ff021a69fb541c733de4dbba0fe.js'),q=require('./da7c31daaf542cf1796023d8e344b98a.js'),r=require('./common/locales/index.js'),s=require('./9fdd4ac31a05c27355910f0d74accd4c.js'),t=require('./42191d95974f14b18961c9f2c730464e.js'),u=require('./1fcc6bd55b687d154a4247e57fe3011d.js'),v=require('./d3976cc01aeebc5b09e11c4135b6bd8d.js'),w=require('./84b183688a46c9e2626d3e6f83365e13.js'),x=require('./eb1fe4da47d7ed10884f8b039b058c5b.js'),y=require('./9ebfd1a4a241684455002e8c6d889fd7.js'),z=require('./881e653f19d837f2408386047cb8c38c.js'),A=require('./b543ae2da406cea63b3ad8951f17b6c0.js'),B=require('./3892cb9d0783075a973c350c41401370.js'),C=require('rimraf'),{default_weapp_header:D}=require('./5498e660c05c574f739a28bd5d202cfa.js'),E='darwin'===process.platform,F=(a,b)=>{if(!a)return!1;b=_extends({},b||{});const c=['setting','compileType','condiction','libVersion','appid','projectname','svr','client','qcloudRoot','miniprogramRoot','cloudfunctionRoot','cloudfunctionTemplateRoot','jsserverRoot','pluginRoot','isGameTourist','packOptions','debugOptions','scripts'];for(const d in b)b.hasOwnProperty(d)&&0>c.findIndex((a)=>a===d)&&delete b[d];const d=t.generateConfigTemplate(),e=_extends({},d,{setting:_extends({},a.setting),compileType:a.compileType,condiction:a.condiction,libVersion:a.libVersion,appid:a.appid,projectname:a.projectname,svr:a.svr,client:a.client,qcloudRoot:a.qcloudRoot,miniprogramRoot:a.miniprogramRoot,cloudfunctionRoot:a.cloudfunctionRoot,cloudfunctionTemplateRoot:a.cloudfunctionTemplateRoot,jsserverRoot:a.jsserverRoot,pluginRoot:a.pluginRoot,packOptions:a.packOptions,debugOptions:a.debugOptions,scripts:a.scripts},b);delete e.setting.scriptsEnable;const f=t.writeObjectToConfigFile(a,e);return!f.error},G=(a,b,c)=>(d)=>{return'parseerror'===a?void d(u.setConfirmInfo({show:!0,showCancel:!0,title:'',content:r.config.RE_CREATE_PROJECT_CONFIG,callback(a){a&&F(b,c)}})):void F(b,c)},H=(a)=>(b,c)=>{const d=c();if(!a){if(a=d.project.current,!a||a.isTemp)return;a.accessTime=+new Date,o.updateProject(a.projectid,a),b({type:f.PROJECT_UPDATE_LIST,list:_extends({},d.project.list,{[a.projectid]:a})})}else a.accessTime=+new Date,o.updateProject(a.projectid,a),b({type:f.PROJECT_UPDATE_LIST,list:_extends({},d.project.list,{[a.projectid]:a})})},I=()=>(a,b)=>{const c=b();c.project.current&&c.window.remoteDebugWindow.debuggingProjectId===c.project.current.projectid&&a(n.setRemoteDebugWindow({show:!1,debuggingProjectId:null})),z.notifyCloseWindow(!0),global.windowMap.forEach((a)=>{try{a!==global.Win&&a.close(!0)}catch(a){}}),nw.Window.get().close(!0)},J=(a=!0)=>async(b)=>{const c=k.getCurrent();if(!(c&&c.isTourist))try{const d=await k.getLatestProjectAttr(c,a);d.appid===c.appid&&b({type:f.PROJECT_UPDATE_ATTR,data:d}),(a||!d.platform)&&(b({type:f.PROJECT_SET_RUMTIME_ATTR,data:d}),b({type:f.SIMULATOR_SET_GROUP_INFO,data:{list:d.share_info}})),b(H())}catch(a){const c=a.errcode;j.error(`requestProjectAttr catch error ${a}`),c===p.DEV_APP_NOT_BAND?b({type:f.PROJECT_UPDATE_ATTR,data:{userbanded:!1}}):(c===p.DEV_PLATFORM_INVALID_EXT_APPID||c===p.DEV_PLATFORM_EXT_APPID_NOT_AUTH)&&b({type:f.PROJECT_MERGE_RUMTIME_ATTR,data:{extAppIdErrMsg:a.message}})}},K=(a,b={needSaveProjectConfig:!0,needSaveProjectInfo:!0})=>async(c)=>{const{needSaveProjectConfig:d,needSaveProjectInfo:e}=b,g=k.getCurrent(),h=g.appid,i=g.projectid,j=i.replace(h,a),l=_extends({},g,{appid:a,projectid:j,isTourist:a===m.TOURIST_APPID});if(l&&l.isTourist)throw new Error('tourist appid');const n=await k.getLatestProjectAttr(l,!1);if(o.updateProjectId(i,j),c({type:f.PROJECT_CHANGE_APPID,data:{appid:a,projectid:j,attr:n}}),await J(!0)(c),d){const a=t.getConfigFileInfo(l);if(a.error)c(G(a.error.type,l,{appid:l.appid}));else{const b=_extends({},a.config,{appid:l.appid});t.writeObjectToConfigFile(l,b)}}e&&c(H(l))},L=(a)=>Object.prototype.toString.call(a).toLowerCase().slice(8,-1),M=(a,b,c,d)=>{return L(b)===c?d?0<=d.findIndex((a)=>a===b)?b:a:b:a},N=async(a,b)=>{try{await K(a,{needSaveProjectConfig:!1,needSaveProjectInfo:!1})(b)}catch(a){throw b(u.setConfirmInfo({show:!0,showCancel:!1,title:r.config.PROJECT_CONFIG_CHANGE_APPID_FAIL,content:a})),a}};module.exports={openWebDebugger:()=>{x.openWebDebugger(),o.lastSelect=m.MAIN_WINDOW_TYPE.WEB_DEBUGGER,q('url_open')},createProjectSuccess:(g,{initQuickStart:h=!1,quickstartHost:i=''}={})=>(l)=>{const n=e.merge(k.projectConfigDefault(g),g);if(h){const e=g.projectpath;let f=h===m.QUICKSTART_TYPE.WEAPP?'weapp':h===m.QUICKSTART_TYPE.WEAPP_TS?'weapp-ts':h===m.QUICKSTART_TYPE.WX_CLOUD?'wxcloud':h===m.QUICKSTART_TYPE.WX_CLOUD_GAME?'wxcloud-game':h===m.QUICKSTART_TYPE.QCLOUD_NODEJS?'node':h===m.QUICKSTART_TYPE.QCLOUD_PHP?'php':h===m.QUICKSTART_TYPE.QCLOUD_NODEJS_GAME?'node-game':h===m.QUICKSTART_TYPE.QCLOUD_PHP_GAME?'php-game':h===m.QUICKSTART_TYPE.PLUGIN?'plugin':h===m.QUICKSTART_TYPE.GAME?'game':h===m.QUICKSTART_TYPE.WEAPP_MINI?'weapp-mini':h===m.QUICKSTART_TYPE.GAME_MINI?'game-mini':h===m.QUICKSTART_TYPE.PLUGIN_MINI?'plugin-mini':'weapp';const k=global.appConfig.isDev?b.join(__dirname,'../../vendor/quickstart',f):b.join(__dirname,'./vendor/quickstart',f);try{const f=d.sync('./**/**',{cwd:k});if(f.forEach((d)=>{const f=b.join(k,d),h=b.join(e,d),i=a.lstatSync(f);if(i.isDirectory())c.sync(h);else{let c=a.readFileSync(f);g.compileType==s.plugin&&'app.json'==b.basename(d)&&(c=c.toString().replace('{{provider}}',g.appid)),a.writeFileSync(h,c)}}),h===m.QUICKSTART_TYPE.QCLOUD_NODEJS){const c=b.join(e,'./server/config.js'),d=a.readFileSync(c,'utf8');if(a.writeFileSync(c,d.replace('appId: \'\',',`appId: '${n.appid}',`).replace('pass: \'\',',`pass: '${n.appid}',`),'utf8'),i){const c=b.join(e,'./client/config.js'),d=a.readFileSync(c,'utf8');a.writeFileSync(c,d.replace('host = \'https://123456.qcloud.la\'',`host = '${i}'`),'utf8')}}else if(h===m.QUICKSTART_TYPE.QCLOUD_PHP){const c=b.join(e,'./server/config.php'),d=a.readFileSync(c,'utf8');if(a.writeFileSync(c,d.replace('\'appId\' => \'\',',`'appId' => '${n.appid}',`).replace('\'pass\' => \'\',',`'pass' => '${n.appid}',`),'utf8'),i){const c=b.join(e,'./client/config.js'),d=a.readFileSync(c,'utf8');a.writeFileSync(c,d.replace('host = \'https://123456.qcloud.la\'',`host = '${i}'`),'utf8')}}else if(h===m.QUICKSTART_TYPE.QCLOUD_NODEJS_GAME){const c=b.join(e,'./server/config.js'),d=a.readFileSync(c,'utf8');if(a.writeFileSync(c,d.replace('appId: \'\',',`appId: '${n.appid}',`).replace('pass: \'\',',`pass: '${n.appid}',`),'utf8'),i){const c=b.join(e,'./client/config.js'),d=a.readFileSync(c,'utf8');a.writeFileSync(c,d.replace('host = \'https://123456.qcloud.la\'',`host = '${i}'`),'utf8')}}else if(h===m.QCLOUD_ACTION_TYPE.QCLOUD_PHP_GAME){const c=b.join(e,'./server/config.php'),d=a.readFileSync(c,'utf8');if(a.writeFileSync(c,d.replace('\'appId\' => \'\',',`'appId' => '${n.appid}',`).replace('\'pass\' => \'\',',`'pass' => '${n.appid}',`),'utf8'),i){const c=b.join(e,'./client/config.js'),d=a.readFileSync(c,'utf8');a.writeFileSync(c,d.replace('host = \'https://123456.qcloud.la\'',`host = '${i}'`),'utf8')}}else if(h===m.QUICKSTART_TYPE.WX_CLOUD){let c=b.join(e,'./project.config.json'),d=a.readFileSync(c,'utf8');a.writeFileSync(c,d.replace('"appId": "",',`"appId": "${n.appid}",`))}else if(h===m.QUICKSTART_TYPE.WX_CLOUD_GAME){let c=b.join(e,'./project.config.json'),d=a.readFileSync(c,'utf8');a.writeFileSync(c,d.replace('"appId": "",',`"appId": "${n.appid}",`))}else if(h===m.QUICKSTART_TYPE.WEAPP_TS){let c=b.join(e,'./project.config.json'),d=JSON.parse(a.readFileSync(c,'utf8'));n.scripts=d.scripts={beforeCompile:'npm run tsc',beforePreview:'npm run tsc',beforeUpload:'npm run tsc'},n.setting.scriptsEnable=!0,a.writeFileSync(c,JSON.stringify(d));const f=b.join(e,'$node_modules'),g=b.join(e,'node_modules');a.existsSync(f)&&!a.existsSync(g)&&a.renameSync(f,g);const h=E?b.join(g,'dotMacBin'):b.join(g,'dotWinBin'),i=E?b.join(g,'dotWinBin'):b.join(g,'dotMacBin'),j=b.join(g,'typescript','bin');if(a.existsSync(h)&&!a.existsSync(j)){a.renameSync(h,j);try{C.sync(i)}catch(a){console.warn(a)}}if(E){const c=b.join(j,'tsc');try{a.chmodSync(c,493)}catch(a){console.warn(a)}}}}catch(a){j.error(`project.actions.js initProject error ${a.toString()}`)}}const o=t.getConfigFileInfo(g);if(!o.error){const a=_extends({},o.config,{appid:n.appid,projectname:n.projectname});g.isGameTourist&&(a.setting.urlCheck=!1),t.writeObjectToConfigFile(g,a)}else F(g,n);l({type:f.PROJECT_CREATE_PROJECT_SUCCESS,project:n}),l(H(n))},createProjectOpen:()=>()=>{y.createProjectOpen()},removeProject:(a)=>(b)=>{o.removeProject(a),A.closeDevWindow(a),b({type:f.PROJECT_REMOVE_PROJECT,id:a})},openProject:(a)=>(b,c)=>new Promise(async(d,f)=>{try{const e=c(),f=e.project.list;f[a]||j.error(`open project with unknown projectid ${a}`);const g=f[a];g&&(g.storage={}),g.accessTime=+new Date;let{appid:h,projectname:i,projectpath:k}=g;k=encodeURIComponent(k),x.openMiniProgram({projectid:a,appid:h,projectname:i,projectpath:k,options:{theme:e.settings.appearance.theme||'white'}}),d(),b(H()),o.lastSelect=a,q('project_open',g.appid)}catch(a){f(a)}}),closeProject:I,closeProjectWithConfirm:()=>(a)=>{const b=3,c=setTimeout(()=>{a(I())},1e3*b);a(u.setConfirmInfo({show:!0,showCancel:!0,title:'',content:r.config.CONFIRM_CLOSE_PROJECT_BY_EXTERNAL.format(b),confirmText:r.config.BLOCK,async callback(b){clearTimeout(c),b||a(I())}})),nw.Window.get().focus()},confirmBeforeIdeQuit:(a,b)=>(c)=>{c(u.setConfirmInfo({show:!0,showCancel:!0,title:'',content:r.config.CONFIRM_QUIT_IDE_BY_EXTERNAL.format(a),confirmText:r.config.BLOCK,async callback(a){a&&b()}})),nw.Window.get().focus()},requestProjectAttr:J,setCompileCondiction:(a)=>(b)=>{b({type:f.PROJECT_SET_COMPILE_CONDICTION,data:a});const c=k.getCurrent(),d=c.compileType,e=t.getConfigFileInfo(c),g=[...c.condiction[d].list];if(e.error)b(G(e.error.type,c,{condiction:_extends({},c.condiction,{[d]:_extends({},c.condiction[d],{list:g})})}));else{const a=_extends({},e.config,{condiction:_extends({},c.condiction,e.config.condiction||{},{[d]:_extends({},c.condiction[d],{list:g})})});t.writeObjectToConfigFile(c,a)}b(H())},removeCompileCondiction:(a)=>(b)=>{b({type:f.PROJECT_REMOVE_COMPILE_CONDICTION,data:a});const c=k.getCurrent(),d=c.compileType,e=t.getConfigFileInfo(c),g=[...c.condiction[d].list];if(e.error)b(G(e.error.type,c,{condiction:_extends({},c.condiction,{[d]:_extends({},c.condiction[d],{list:g})})}));else{const a=_extends({},e.config,{condiction:_extends({},c.condiction,e.config.condiction||{},{[d]:_extends({},c.condiction[d],{list:g})})});t.writeObjectToConfigFile(c,a)}b(H())},setProjectSetting:(a)=>(b)=>{const c=k.getCurrent();b({type:f.PROJECT_SET_SETTING,data:a});const d=t.getConfigFileInfo(c);if(d.error){const e=_extends({},c.setting,a);delete e.scriptsEnable,b(G(d.error.type,c,{setting:e}))}else{const b=_extends({},d.config,{setting:_extends({},c.setting,d.config.setting||{},a)});delete b.setting.scriptsEnable,t.writeObjectToConfigFile(c,b)}b(H())},selectCompileCondiction:(a)=>(b)=>{b({type:f.PROJECT_SELECT_COMPILE_CONDICTION,current:a}),b({type:f.SIMULATOR_COMPILE,data:{}}),b(H())},setProjectLibVersion:(a)=>(b)=>{l.setVersionAsync(a),b({type:f.PROJECT_SET_LIBVERSION,data:a});const c=k.getCurrent(),d=t.getConfigFileInfo(c);if(d.error)b(G(d.error.type,c,{libVersion:a}));else{const b=_extends({},d.config,{libVersion:a});t.writeObjectToConfigFile(c,b)}b(H())},setProjectSimulatorPluginLibVersion:(a)=>(b)=>{const c=k.getCurrent(),d=c.simulatorType;if(d!==h.wechat){const g=e.cloneDeep(c.simulatorPluginLibVersion);g[d]=a,b({type:f.PROJECT_SET_SIMULATOR_LIB_VERSION,data:g});const h=t.getConfigFileInfo(c);if(h.error)b(G(h.error.type,c,{simulatorPluginLibVersion:g}));else{const a=_extends({},h.config,{simulatorPluginLibVersion:g});t.writeObjectToConfigFile(c,a)}b(H())}},checkUploadStatus:()=>{const a=k.getCurrent();if(a.compileType==s.plugin){const a=r.config.UPLOAD_PLUG_IN_CONTINUE;return{type:f.INFO_SET_UPLOAD,data:{status:1,wording:a}}}if(a&&a.pluginInfo&&a.pluginInfo.length)try{for(const b of a.pluginInfo)if(b.current&&b.onlineVersion&&b.onlineVersion!==b.current.version&&0>w.compareSemVer(b.current.version,b.onlineVersion))return{type:f.INFO_SET_UPLOAD,data:{status:1,wording:r.config.PLUG_IN_VERSION_LOWER.format([b.name,b.current.version,b.onlineVersion])}}}catch(a){j.error(`project.actions.js check plugin info during checkUploadStatus failed with error: ${a.toString()}`)}return(b)=>{i({url:`${g.uploadQrCodeURL}?appid=${a.appid}`,method:'get',needToken:1}).then(({resp:a,body:c})=>{const d=1===c.is_experience?r.config.OVERWRITE_TRIAL_VERSION:r.config.SET_UPLOAD_TRIAL_VERSION;b({type:f.INFO_SET_UPLOAD,data:{status:1,wording:d}})}).catch((a)=>{b({type:f.INFO_SET_UPLOAD,data:{show:!1}}),b({type:f.INFO_SHOW_ERROR,data:{message:a.toString()}})})}},setProjectCompileType:(a)=>(b)=>{b({type:f.PROJECT_SET_COMPILE_TYPE,data:a});const c=k.getCurrent(),d=t.getConfigFileInfo(c);if(d.error)b(G(d.error.type,c,{compileType:a}));else{const b=_extends({},d.config,{compileType:a});t.writeObjectToConfigFile(c,b)}b(H())},setProjectSimulatorType:(a)=>(b,c)=>{b({type:f.PROJECT_SET_SIMULATOR_TYPE,data:a});const d=k.getCurrent(),g=t.getConfigFileInfo(d),i=c().plugin.pluginManifests,j=e.cloneDeep(d.simulatorPluginLibVersion);if(a!==h.wechat&&i[a].libs&&0<Object.keys(i[a].libs).length&&!j[a]&&(j[a]=Object.keys(i[a].libs)[0]),b({type:f.PROJECT_SET_SIMULATOR_LIB_VERSION,data:j}),g.error)b(G(g.error.type,d,{simulatorType:a,simulatorPluginLibVersion:j}));else{const b=_extends({},g.config,{simulatorType:a,simulatorPluginLibVersion:j});t.writeObjectToConfigFile(d,b)}b(H())},setProjectQCloud:(a)=>({type:f.PROJECT_SET_QCLOUD,data:a}),setPkgSize:(a)=>(b)=>{b({type:f.PROJECT_SET_PKG_SIZE,data:a}),b(H())},setPluginInfo:(a)=>(b)=>{b({type:f.PROJECT_SET_PLUGIN_INFO,data:a}),b(H())},setProjectConfig:(a,b={needCheckAppid:!0,needConfirmToChangeAppid:!1})=>async(c)=>{const d=k.getCurrent();a.setting=a.setting||{},a.scripts=M({},a.scripts,'object'),a.condiction=a.condiction||{},a.condiction.weapp=a.condiction.weapp||{},a.condiction.weapp.list=M([...d.condiction.weapp.list],a.condiction.weapp.list,'array'),a.condiction.search=a.condiction.search||{},a.condiction.search.list=M([...d.condiction.search.list],a.condiction.search.list,'array'),a.condiction.conversation=a.condiction.conversation||{},a.condiction.conversation.list=M([...d.condiction.conversation.list],a.condiction.conversation.list,'array'),a.condiction.plugin=a.condiction.plugin||{},a.condiction.plugin.list=M([...d.condiction.plugin.list],a.condiction.plugin.list,'array'),a.condiction.game=a.condiction.game||{},a.condiction.game.list=M([...d.condiction.game.list],a.condiction.game.list,'array'),a.packOptions=a.packOptions||{},a.packOptions.ignore=M([],a.packOptions.ignore,'array'),a.debugOptions=a.debugOptions||{},a.debugOptions.hidedInDevtools=M([],a.debugOptions.hidedInDevtools,'array');const e=[],g=['folder','file','suffix','prefix','glob','regexp'];for(const b of a.packOptions.ignore)b&&'string'===L(b.value)&&0<=g.findIndex((a)=>a===b.type)&&e.push({value:b.value,type:b.type});const h=[],i=['folder','file','suffix','prefix','glob','regexp'];for(const b of a.debugOptions.hidedInDevtools)b&&'string'===L(b.value)&&0<=i.findIndex((a)=>a===b.type)&&h.push({value:b.value,type:b.type});const j=[];for(const b of a.condiction.weapp.list)b&&'number'===L(b.id)&&'string'===L(b.name)&&'string'===L(b.pathName)&&j.push({id:b.id,name:b.name,pathName:b.pathName,query:M('',b.query,'string'),scene:b.scene,shareInfo:M(void 0,b.shareInfo,'object'),referrerInfo:M(void 0,b.referrerInfo,'object')});const m=[];for(const b of a.condiction.plugin.list)b&&'number'===L(b.id)&&'string'===L(b.name)&&'string'===L(b.pathName)&&m.push({id:b.id,name:b.name,pathName:b.pathName,query:M('',b.query,'string'),scene:b.scene,shareInfo:M(void 0,b.shareInfo,'object'),referrerInfo:M(void 0,b.referrerInfo,'object')});const n=[];for(const b of a.condiction.search.list)b&&'number'===L(b.id)&&'string'===L(b.name)&&n.push({id:b.id,name:b.name,widgetData:M('',b.widgetData,'string'),service:M(void 0,b.service,'object'),query:M('',b.query,'string'),customQuery:M('',b.customQuery,'string'),boxQI:M('',b.boxQI,'string'),debugUrl:M('',b.debugUrl,'string')});const p=[];for(const b of a.condiction.conversation.list)b&&'number'===L(b.id)&&'string'===L(b.name)&&p.push({id:b.id,name:b.name,pathName:M(void 0,b.pathName,'string'),title:M(void 0,b.title,'string'),cachekey:M(void 0,b.cachekey,'string')});const q=[];for(const b of a.condiction.game.list)b&&'number'===L(b.id)&&'string'===L(b.name)&&q.push({id:b.id,name:b.name,query:M('',b.query,'string'),scene:b.scene,shareInfo:M(void 0,b.shareInfo,'object'),referrerInfo:M(void 0,b.referrerInfo,'object')});const o=l.getVendorConfig(),s=k.isGameApp(d)?['game']:['weapp','plugin'],t={setting:{urlCheck:M(d.setting.urlCheck,a.setting.urlCheck,'boolean'),es6:M(d.setting.es6,a.setting.es6,'boolean'),postcss:M(d.setting.postcss,a.setting.postcss,'boolean'),minified:M(d.setting.minified,a.setting.minified,'boolean'),newFeature:M(d.setting.newFeature,a.setting.newFeature,'boolean'),nodeModules:M(d.setting.nodeModules,a.setting.nodeModules,'boolean'),autoAudits:M(d.setting.autoAudits,a.setting.autoAudits,'boolean'),uglifyFileName:M(d.setting.uglifyFileName,a.setting.uglifyFileName,'boolean'),checkInvalidKey:!1!==a.setting.checkInvalidKey,scriptsEnable:d.setting.scriptsEnable},scripts:{beforeCompile:M(d.scripts.beforeCompile,a.scripts.beforeCompile,'string'),beforePreview:M(d.scripts.beforePreview,a.scripts.beforePreview,'string'),beforeUpload:M(d.scripts.beforeUpload,a.scripts.beforeUpload,'string')},compileType:M(d.compileType,a.compileType,'string',['game','weapp','search','conversation','plugin']),condiction:{weapp:{current:d.condiction.weapp.current,list:[...j]},search:{current:d.condiction.search.current,list:[...n]},conversation:{current:d.condiction.conversation.current,list:[...p]},plugin:{current:d.condiction.plugin.current,list:[...m]},game:{current:d.condiction.game.current,list:[...q]}},appid:a.appid||'',projectid:(d.projectid||'').replace(d.appid,a.appid),libVersion:M(d.libVersion,a.libVersion,'string',Object.keys(o.libs)),svr:M(d.svr,a.svr||'','string'),client:M(d.client,a.client||'','string'),qcloudRoot:M(d.qcloudRoot,a.qcloudRoot||'','string'),miniprogramRoot:M(d.miniprogramRoot,a.miniprogramRoot||'','string'),cloudfunctionRoot:M(d.cloudfunctionRoot,a.cloudfunctionRoot||'','string'),cloudfunctionTemplateRoot:M(d.cloudfunctionTemplateRoot,a.cloudfunctionTemplateRoot||'','string'),jsserverRoot:M(d.jsserverRoot,a.jsserverRoot||'','string'),pluginRoot:M(d.pluginRoot,a.pluginRoot||'','string'),packOptions:{ignore:e},debugOptions:{hidedInDevtools:h}};if(!t.qcloudRoot&&t.svr&&(t.qcloudRoot=t.svr),!t.miniprogramRoot&&t.client&&(t.miniprogramRoot=t.client),t.libVersion!==d.libVersion&&l.setVersionAsync(t.libVersion),0>s.indexOf(t.compileType)&&(t.compileType=k.isGameApp(d)?'game':'weapp'),b.needCheckAppid&&t.appid&&t.appid!==d.appid){if(b.needConfirmToChangeAppid)return void c(u.setConfirmInfo({show:!0,showCancel:!0,title:'',content:r.config.PROJECT_CONFIG_CHANGE_APPID_CONFIRM.format([t.appid,d.appid,t.appid]),async callback(a){if(a)try{await N(t.appid,c)}catch(a){t.appid=d.appid,t.projectid=d.projectid}else t.appid=d.appid,t.projectid=d.projectid;c({type:f.PROJECT_SET_PROJECT_CONFIG,data:JSON.parse(JSON.stringify(t))}),c(H())}}));try{await N(t.appid,c)}catch(a){t.appid=d.appid,t.projectid=d.projectid}}c({type:f.PROJECT_SET_PROJECT_CONFIG,data:JSON.parse(JSON.stringify(t))}),c(H())},setProjectRuntimeAttr:(a)=>({type:f.PROJECT_SET_RUMTIME_ATTR,data:a}),saveUploadInfo:(a)=>(b)=>{b({type:f.PROJECT_SET_UPLOAD_INFO,data:a}),b(H())},saveShareInfo:(a)=>(b,c)=>{try{const d=c(),e=d.project.current;if(!e)return;let g=e.shareInfo||{};const h=g.history||[];h.unshift(a),g=_extends({},g,{history:h}),b({type:f.PROJECT_SET_SHARE_INFO,data:g}),b(H())}catch(a){}},updateProjectCover:(a)=>(b,c)=>{let d=a.project;if(!d){const b=c();if(d=b.project.current,!d)return;o.setProjectCover(d.projectid,a.image)}else o.setProjectCover(d.projectid,a.image)},openTempProject:(a)=>()=>{let{projectid:b,appid:c,projectname:d,projectpath:e}=a;d=encodeURIComponent(d),e=encodeURIComponent(e),x.openTempOnlineMiniProgram({projectid:b,appid:c,projectname:d,projectpath:e})},syncProject:(a,b)=>({type:f.PROJECT_SYNC_STORE,data:a,syncTime:b}),setProjectScripts:(a)=>(b)=>{const c=k.getCurrent();b({type:f.PROJECT_SET_SCRIPTS,data:a});const d=t.getConfigFileInfo(c);if(d.error)b(G(d.error.type,c,{scripts:_extends({},c.scripts,a)}));else{const b=_extends({},d.config,{scripts:_extends({},c.scripts,d.config.scripts||{},a)});t.writeObjectToConfigFile(c,b)}b(H())},setTimeRecords:(a)=>(b)=>{b({type:f.PROJECT_SET_TIME_RECORDS,data:a})},changeProjectAppId:K,setTcbFnRoot:(a)=>(b)=>{const c=k.getCurrent();b({type:f.PROJECT_SET_TCBFN_ROOT,data:a});const d=t.getConfigFileInfo(c);if(d.error)b(G(d.error.type,c,{cloudfunctionRoot:a}));else{const b=_extends({},d.config,{cloudfunctionRoot:a});t.writeObjectToConfigFile(c,b)}b(H())},setTcbFnTemplateRoot:(a)=>(b)=>{const c=k.getCurrent();b({type:f.PROJECT_SET_TCBFNTEMPLATE_ROOT,data:a});const d=t.getConfigFileInfo(c);if(d.error)b(G(d.error.type,c,{cloudfunctionTemplateRoot:a}));else{const b=_extends({},d.config,{cloudfunctionTemplateRoot:a});t.writeObjectToConfigFile(c,b)}b(H())}}}(require('lazyload'),require);